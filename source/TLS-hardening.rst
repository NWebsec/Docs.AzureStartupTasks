#############
TLS hardening
#############

The TLS hardening startup task will configure Azure instances according to the latest recommendations at `SSL Labs <http://www.ssllabs.com>`_. The startup task will reboot the instances if the TLS configuration is updated, so the provisioning time for new Azure instances will increase. Note that the startup task does this intelligently and reboots only if a configuration change is needed, so redeploying an application will not trigger a reboot.

You can use the startup task for Azure instances running Guest OS version 2 or newer.

*****************
TLS configuration
*****************

The recommended TLS configuration is likely to change over time, configuration for each version of NWebsec.AzureStartupTasks is accounted for here.

NWebsec.AzureStartupTasks 1.1.2
===============================

Removed the two AES-GCM cipher suites from TLS configuration to avoid potential issues introduced by `MS14-066 <https://support.microsoft.com/kb/2992611>`_.

::

	TLS_RSA_WITH_AES_256_GCM_SHA384
	TLS_RSA_WITH_AES_128_GCM_SHA256

Protocol support:

* Disabled: SSL 2/3
* Enabled: TLS 1.0/1.1/1.2

Enabled cipher suites (highest priority first):

::

	TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P256
	TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384
	TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256
	TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P256
	TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P384
	TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P256
	TLS_RSA_WITH_AES_256_CBC_SHA256
	TLS_RSA_WITH_AES_128_CBC_SHA256
	TLS_RSA_WITH_AES_256_CBC_SHA
	TLS_RSA_WITH_AES_128_CBC_SHA
	TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384
	TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256
	TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P384
	TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P256
	TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P256
	TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P384
	TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P256
	TLS_DHE_DSS_WITH_AES_256_CBC_SHA256
	TLS_DHE_DSS_WITH_AES_128_CBC_SHA256
	TLS_DHE_DSS_WITH_AES_256_CBC_SHA
	TLS_DHE_DSS_WITH_AES_128_CBC_SHA
	TLS_RSA_WITH_3DES_EDE_CBC_SHA
	TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA

NWebsec.AzureStartupTasks 1.1.1
===============================

Removed the following cipher suites using DHE, as you get penalized by SSL Labs for weak key exchange.

::

	TLS_DHE_RSA_WITH_AES_256_GCM_SHA384
	TLS_DHE_RSA_WITH_AES_128_GCM_SHA256

Protocol support:

* Disabled: SSL 2/3
* Enabled: TLS 1.0/1.1/1.2

Enabled cipher suites (highest priority first):

::

	TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P256
	TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384
	TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256
	TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P256
	TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P384
	TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P256
	TLS_RSA_WITH_AES_256_GCM_SHA384
	TLS_RSA_WITH_AES_128_GCM_SHA256
	TLS_RSA_WITH_AES_256_CBC_SHA256
	TLS_RSA_WITH_AES_128_CBC_SHA256
	TLS_RSA_WITH_AES_256_CBC_SHA
	TLS_RSA_WITH_AES_128_CBC_SHA
	TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384
	TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256
	TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P384
	TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P256
	TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P256
	TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P384
	TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P256
	TLS_DHE_DSS_WITH_AES_256_CBC_SHA256
	TLS_DHE_DSS_WITH_AES_128_CBC_SHA256
	TLS_DHE_DSS_WITH_AES_256_CBC_SHA
	TLS_DHE_DSS_WITH_AES_128_CBC_SHA
	TLS_RSA_WITH_3DES_EDE_CBC_SHA
	TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA

NWebsec.AzureStartupTasks 1.1.0
===============================

TLS configuration in accordance with the SSL Labs TLS configuration guidance v. 1.3.

Adds the new AES-GCM cipher suites introduced in the [Windows 8.1 and Windows Server 2012 R2 Update](http://support.microsoft.com/kb/2929781).

Protocol support:

* Disabled: SSL 2/3
* Enabled: TLS 1.0/1.1/1.2

Enabled cipher suites (highest priority first):
::

	TLS_DHE_RSA_WITH_AES_256_GCM_SHA384
	TLS_DHE_RSA_WITH_AES_128_GCM_SHA256
	TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P256
	TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384
	TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256
	TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P256
	TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P384
	TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P256
	TLS_RSA_WITH_AES_256_GCM_SHA384
	TLS_RSA_WITH_AES_128_GCM_SHA256
	TLS_RSA_WITH_AES_256_CBC_SHA256
	TLS_RSA_WITH_AES_128_CBC_SHA256
	TLS_RSA_WITH_AES_256_CBC_SHA
	TLS_RSA_WITH_AES_128_CBC_SHA
	TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384
	TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256
	TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P384
	TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P256
	TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P256
	TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P384
	TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P256
	TLS_DHE_DSS_WITH_AES_256_CBC_SHA256
	TLS_DHE_DSS_WITH_AES_128_CBC_SHA256
	TLS_DHE_DSS_WITH_AES_256_CBC_SHA
	TLS_DHE_DSS_WITH_AES_128_CBC_SHA
	TLS_RSA_WITH_3DES_EDE_CBC_SHA
	TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA

NWebsec.AzureStartupTasks 1.0.0
===============================
TLS configuration in accordance with the SSL Labs TLS configuration guidance v. 1.3.

Protocol support:

* Disabled: SSL 2/3
* Enabled: TLS 1.0/1.1/1.2

Enabled cipher suites (highest priority first):
::

	TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256
	TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384
	TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256
	TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P384
	TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P256
	TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P384
	TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P256
	TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P384
	TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P256
	TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P256
	TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P384
	TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P256
	TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P384
	TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P384
	TLS_DHE_DSS_WITH_AES_128_CBC_SHA256
	TLS_DHE_DSS_WITH_AES_128_CBC_SHA
	TLS_DHE_DSS_WITH_AES_256_CBC_SHA256
	TLS_DHE_DSS_WITH_AES_256_CBC_SHA
	TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA
	TLS_RSA_WITH_AES_128_CBC_SHA256
	TLS_RSA_WITH_AES_128_CBC_SHA
	TLS_RSA_WITH_AES_256_CBC_SHA256
	TLS_RSA_WITH_AES_256_CBC_SHA
	TLS_RSA_WITH_3DES_EDE_CBC_SHA
